<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head'); -%>
    <%- include('../partials/table'); -%>
    <link rel="stylesheet" type="text/css" href="css/stats.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>
    <div class="pageBody">
        <%- include('../partials/nav_bar'); %>
        <div class="stats_form">
            <form action="/web_stats" method="post">
                <label for="period">Length</label>
                <input type="text" id="period" name="period" type="number" required>
                <label for="time_unit">Time Unit:</label>
                <select id="unit" name="unit">
                    <option value="day">Day</option>
                    <option value="month">Month</option>
                    <option value="hour">Hour</option>
                </select>
                <button type="submit" value="web_stats">
                    Change Time Frame
                </button>
            </form>
        </div>
        <div class="stats_chart_title">
            <p>Total and Unique Visits per Time Period</p>
        </div>
        <div id="chart" class="stats_chart"></div>
        <div class="stats_tables">
            <div class="by_page">
                <p>Page Visits</p>
                <table id="page_table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Page</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% countByPage.forEach(([page, count], i) => { %>
                            <tr>
                                <td><%- i + 1 %></td>
                                <td><%- page %></td>
                                <td><%- count %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            <div class="by_visitor">
                <p>Count by Visitor</p>
                <table id="visit_table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Visitor</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% countByVisitor.forEach(([visitor, count], i) => { %>
                            <tr>
                                <td><%- i + 1 %></td>
                                <td><%- visitor %></td>
                                <td><%- count %></td>
                            </tr>
                        <% }); %> 
                    </tbody>
                </table>
            </div>
        </div>
        <footer>
            <%- include('../partials/footer'); %>
        </footer>
    </div>
<script src="javascript/table_settings.js"></script>
<script>
const chart = new ApexCharts(document.querySelector("#chart"), <%- JSON.stringify(options) %>);
chart.render();
</script>
</body>
</html>